import{D as H}from"./database-BKbkAfuS.js";import I from"./user-DaildQOo.js";import Y from"./useAuth-CUFXkQq0.js";import{_ as G}from"./InputTextFloat.vue_vue_type_script_setup_true_lang-BuX1Xa47.js";import J from"./role-p2M_FLkO.js";import{d as D,r as b,b as $,q as m,o as i,c as h,D as w,f as x,a as t,e as n,m as M,A as k,F as C,y as K,k as Q,L as W,H as X,M as Z,C as F,n as _,u as p,E as ee}from"./index-C2YWHtWb.js";import{S as le}from"./Universal-Q_iCI1DR.js";import{_ as L}from"./DebounceButton.vue_vue_type_script_setup_true_lang-49f_5Git.js";import{C as te}from"./useDate-CVzJcmyJ.js";import{s as U,e as N}from"./useToast-Deq2fcpw.js";/* empty css                                                                       */import{F as B}from"./FloatText-DF01zB1J.js";import"./Editor-kc3vYnik.js";class R extends H{constructor(){super("member")}async getPublic(v){return this.get(`${v}/public/${v}`).then(o=>o).catch(o=>{throw o})}}const ae={class:"p-float-label"},oe=["for"],ne=D({__name:"RoleDropdownFloat",props:{modelValue:[String,Number,Object],type:{type:String,default:"text"},label:{type:String,default:"權限"},name:{type:String,default:"-"},placeholder:{type:String},rules:{type:String},disabled:{type:Boolean}},setup(e){const v=new J,o=b([{id:"",displayName:"無"}]),c=b(0);return $(()=>{v.array().then(s=>{s.filter(d=>o.value.push({id:d.id,displayName:d.displayName}))}),setTimeout(()=>{c.value==0&&c.value++},500)}),(s,d)=>{const y=m("Dropdown"),V=m("VField"),f=m("ErrorMessage");return i(),h(C,null,[(i(),w(V,{key:c.value,name:e.name,label:e.label,type:e.type,class:"p-inputtext p-component",rules:e.rules,value:e.modelValue,onChange:d[0]||(d[0]=l=>s.$emit("update:modelValue",l.value))},{default:x(({field:l})=>[t("span",ae,[n(y,M({class:["w-full",{"p-filled":e.modelValue}]},l,{modelValue:e.modelValue,value:e.modelValue,placeholder:e.placeholder,id:e.name,options:o.value,optionLabel:"displayName",disabled:e.disabled}),null,16,["class","modelValue","value","placeholder","id","options","disabled"]),t("label",{for:e.name},k(e.label),9,oe)])]),_:1},8,["name","label","type","rules","value"])),n(f,{name:e.name,class:"p-error"},null,8,["name"])],64)}}}),se={class:"p-float-label"},ie=["for"],de=D({__name:"StateDropdownFloat",props:{modelValue:[String,Number,Object],type:{type:String,default:"text"},label:{type:String,default:"狀態"},name:{type:String,default:"-"},placeholder:{type:String},rules:{type:String},disabled:{type:Boolean}},setup(e){const v=b([...le]),o=b(0);return $(()=>{setTimeout(()=>{o.value==0&&o.value++},500)}),(c,s)=>{const d=m("Dropdown"),y=m("VField"),V=m("ErrorMessage");return i(),h(C,null,[(i(),w(y,{key:o.value,name:e.name,label:e.label,type:e.type,class:"p-inputtext p-component",rules:e.rules,value:e.modelValue,onChange:s[0]||(s[0]=f=>c.$emit("update:modelValue",f.value))},{default:x(({field:f})=>[t("span",se,[n(d,M({class:["w-full",{"p-filled":e.modelValue}]},f,{modelValue:e.modelValue,value:e.modelValue,placeholder:e.placeholder,id:e.name,options:v.value,optionLabel:"text",optionValue:"value",disabled:e.disabled}),null,16,["class","modelValue","value","placeholder","id","options","disabled"]),t("label",{for:e.name},k(e.label),9,ie)])]),_:1},8,["name","label","type","rules","value"])),n(V,{name:e.name,class:"p-error"},null,8,["name"])],64)}}}),ue={class:"p-float-label"},re=["for"],me=D({__name:"MemberDropdownFloat",props:{modelValue:[String,Number,Object],type:{type:String,default:"text"},label:{type:String,default:"會員"},name:{type:String,default:"-"},placeholder:{type:String},rules:{type:String},disabled:{type:Boolean},filter:{type:Boolean,default:!0}},setup(e){const v=new R,o=b([]),c=b(0);return $(()=>{v.array().then(s=>{o.value=s}),setTimeout(()=>{c.value==0&&c.value++},500)}),(s,d)=>{const y=m("Dropdown"),V=m("VField"),f=m("ErrorMessage");return i(),h(C,null,[(i(),w(V,{key:c.value,name:e.name,label:e.label,type:e.type,class:"p-inputtext p-component",rules:e.rules,value:e.modelValue,onChange:d[0]||(d[0]=l=>s.$emit("update:modelValue",l.value))},{default:x(({field:l})=>[t("span",ue,[n(y,M({class:["w-full",{"p-filled":e.modelValue}]},l,{modelValue:e.modelValue,value:e.modelValue,placeholder:e.placeholder,id:e.name,options:o.value,optionLabel:"email",disabled:e.disabled,filter:e.filter}),null,16,["class","modelValue","value","placeholder","id","options","disabled","filter"]),t("label",{for:e.name},k(e.label),9,re)])]),_:1},8,["name","label","type","rules","value"])),n(f,{name:e.name,class:"p-error"},null,8,["name"])],64)}}}),ce={class:"grid"},ve={class:"col-12 px-2"},fe={class:"card p-fluid"},pe={class:"flex"},be={class:"flex align-items-center"},ye={key:0},he={key:1,class:"m-0"},Ve={key:0,class:"flex-1"},ge={class:"flex justify-content-end align-items-center"},we={class:"mr-1"},xe={class:"flex justify-content-end"},Se={class:"grid p-fluid mt-3"},Fe={class:"col-12 md:col-6"},ke={class:"col-12 md:col-6"},De={class:"col-12 md:col-6"},$e={class:"col-12 md:col-6"},Ce={class:"col-12 md:col-6"},Ue={class:"col-12 md:col-6"},Ne=t("div",{class:"md:col-6"},null,-1),Be={class:"col-12 md:col-6"},Me=t("div",{class:"flex align-items-center justify-content-center"},[t("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}}),t("span",null,"是否發送重設密碼信件？")],-1),Ge=D({__name:"UserPage",props:{mode:{type:String,default:""}},setup(e){const v=K(),o=Q(),c=new te,s=e,d=new Y,y=new I,V=new R,f=b(""),l=b({...W}),S=b(),g=b(!1),j=async u=>{s.mode==="add"?d.membersBecomeUser(S.value,u).then(a=>{a&&(U(a),o.push("/system/user/list"))}).catch(a=>{N(a)}):s.mode==="edit"&&y.updateUser(u).then(a=>{U(a),o.push("/system/user/list")}).catch(a=>{N(a)})},P=()=>{d.sendPassword(l.value.email).then(u=>{u&&(g.value=!1,U("重設密碼信件已寄出"))}).catch(u=>{g.value=!1,N(u)})},q=()=>{g.value=!0},A=()=>{g.value=!1};return $(()=>{s.mode==="edit"&&(f.value=v.params.id,y.get(f.value).then(u=>{l.value=u}))}),X(async()=>{if(S.value){const u=await V.getPublic(S.value.uid);l.value.uid=u.uid,l.value.displayName=u.displayName,l.value.photoURL=u.photoURL}}),(u,a)=>{const O=m("VForm"),E=m("Button"),T=m("Dialog"),z=Z("role");return i(),h(C,null,[t("div",ce,[t("div",ve,[n(O,{ref:"signupForm",onSubmit:a[5]||(a[5]=r=>j(l.value))},{default:x(()=>[t("div",fe,[t("div",pe,[t("div",be,[e.mode==="add"?(i(),h("h5",ye,"新增帳號")):e.mode==="edit"?(i(),h("h5",he,"編輯帳號")):F("",!0)]),e.mode==="edit"?(i(),h("div",Ve,[t("div",ge,[t("span",we,k(l.value.emailVerified?"已驗證信箱":"未驗證信箱"),1),t("i",{id:"emailVerified",class:_(["pi",{"pi-check-circle text-green-500":l.value.emailVerified,"pi-times-circle text-red-400":!l.value.emailVerified}])},null,2)]),t("div",xe,[t("span",null,"上次登入時間 "+k(p(c).convertDate(l.value.operateAt)),1)])])):F("",!0)]),t("div",Se,[t("div",Fe,[e.mode==="add"?(i(),w(p(me),{key:0,modelValue:S.value,"onUpdate:modelValue":a[0]||(a[0]=r=>S.value=r),name:"email",rules:"required"},null,8,["modelValue"])):F("",!0),e.mode==="edit"?(i(),w(p(B),{key:1,label:"信箱",content:l.value.email},null,8,["content"])):F("",!0)]),t("div",ke,[n(p(B),{label:"UID",content:l.value.uid},null,8,["content"])]),t("div",De,[n(p(B),{label:"名稱",content:l.value.displayName},null,8,["content"])]),t("div",$e,[n(p(G),{label:"照片",modelValue:l.value.photoURL,"onUpdate:modelValue":a[1]||(a[1]=r=>l.value.photoURL=r),name:"photoURL"},null,8,["modelValue"])]),t("div",Ce,[n(p(de),{modelValue:l.value.state,"onUpdate:modelValue":a[2]||(a[2]=r=>l.value.state=r),name:"state",rules:"required"},null,8,["modelValue"])]),ee((i(),h("div",Ue,[n(p(ne),{modelValue:l.value.role,"onUpdate:modelValue":a[3]||(a[3]=r=>l.value.role=r),name:"role",rules:"required"},null,8,["modelValue"])])),[[z,["role:r"]]]),Ne,t("div",Be,[e.mode==="edit"?(i(),w(p(L),{key:0,label:"重設密碼",type:"button",severity:"warning",onClick:a[4]||(a[4]=r=>q())})):F("",!0)])]),n(p(L),{label:"送出",type:"submit"})])]),_:1},512)])]),n(T,{header:"確認",visible:g.value,"onUpdate:visible":a[7]||(a[7]=r=>g.value=r),style:{width:"350px"},modal:!0},{footer:x(()=>[n(E,{label:"No",icon:"pi pi-times",onClick:A,class:"p-button-text",autofocus:""}),n(E,{label:"Yes",icon:"pi pi-check",onClick:a[6]||(a[6]=r=>P()),class:"p-button-text"})]),default:x(()=>[Me]),_:1},8,["visible"])],64)}}});export{Ge as _};
