import{d as Y,r as s,b as q,o as k,c as R,a as l,e as a,f as i,E as b,D as G,u as H,q as u,k as J,L as K,x as C,A as O}from"./index-C0IYFN2w.js";import{U as P}from"./UniversalTable-BIqBLIsS.js";import"./database-B5mFUmtQ.js";import{M as Q}from"./member-CM71EHXB.js";import{S as W,F as X}from"./useFireStorage-Bkb40Xyt.js";import{s as h,e as g}from"./useToast-CIqEXRhq.js";/* empty css                                                                       */import"./user-CRyQV22G.js";const Z={class:"grid"},ee={class:"col-12 px-2"},te={class:"card"},oe={class:"mb-2"},ae={class:"my-2"},le=l("p",null,"將檔案拖移到此處上傳",-1),se={class:"flex align-items-center justify-content-center"},ie=l("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),ne=l("div",{class:"flex align-items-center justify-content-center"},[l("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}}),l("span",null,"你確定要刪除所選的檔案嗎?")],-1),he=Y({__name:"StorageList",setup(re){const _=J(),D=new W,F=new Q,m=new X,y=s([]),p=s(),r=s([]),c=s(!1),d=s(!1),U=s(),z=s([{field:"id",header:"ID",sortable:!0,style:"min-width:6rem;"},{field:"name",header:"檔名",sortable:!0,style:"min-width:6rem;"},{field:"methods",header:"用途",sortable:!0,style:"min-width:8rem;"},{field:"uploaderemail",header:"上傳者帳號",sortable:!0,style:"min-width:12rem;"},{field:"uploaderuid",header:"上傳者UID",sortable:!0,style:"min-width:10rem;"},{type:"date",field:"createdAt",header:"上傳時間",sortable:!0,style:"min-width:12rem;"}]),w=s([{type:"Dropdown",options:[],placeholder:"帳號",class:"md:mr-1 md:w-3",field:"uploaderemail"},{type:"InputText",placeholder:"Search...",class:"md:w-3",field:"id"}]),x=s(),B=t=>{x.value=t.files},L=()=>{x.value.map(t=>{m.uploadStorage(t).then(e=>{e&&h(e)}).catch(e=>{g(e)})})},f=()=>{D.array().then(t=>{y.value=t})},N=t=>{_.push(`/system/storage/read/${t.id}`)},T=t=>{p.value=t,c.value=!0},$=async()=>{await m.deleteStorage(p.value).then(t=>{h(t),_.push("/system/storage/list")}).catch(t=>{g(t)}),f(),c.value=!1},A=()=>{d.value=!0},I=async()=>{await Promise.all(r.value.map(async t=>{await m.deleteStorage(t).then(()=>{}).catch(e=>{g(e)})})),h("刪除成功"),r.value=[],f(),d.value=!1};return q(()=>{f(),F.array().then(t=>{t.filter(e=>w.value[0].options.push({value:e.email,text:e.email}))})}),(t,e)=>{const n=u("Button"),M=u("Toolbar"),V=u("FileUpload"),j=u("Column"),S=u("Dialog"),v=K("role");return k(),R("div",Z,[l("div",ee,[l("div",te,[l("div",oe,[a(M,{class:"mb-2"},{start:i(()=>[l("div",ae,[b(a(n,{label:"刪除",icon:"pi pi-trash",class:"p-button-danger",onClick:A,disabled:!r.value||!r.value.length},null,8,["disabled"]),[[v,["storage:d"]]])])]),_:1}),b((k(),G(V,{name:"demo[]",onUploader:L,onSelect:e[0]||(e[0]=o=>B(o)),fileLimit:10,multiple:!0,accept:"image/*",maxFileSize:3e6,customUpload:"",chooseLabel:"選擇",uploadLabel:"上傳",cancelLabel:"取消"},{empty:i(()=>[le]),_:1})),[[v,["storage:c"]]])]),a(H(P),{ref_key:"dt",ref:U,data:y.value,columns:z.value,selection:r.value,"onUpdate:selection":e[1]||(e[1]=o=>r.value=o),header:"貯存管理",checkbox:!0,filter:w.value,sortField:"createdAt",tableStyle:"min-width:1000px;",fixed:"",resizableColumns:""},{footer:i(()=>[a(j,{style:"min-width:2rem",header:"操作",alignFrozen:"right",frozen:""},{body:i(o=>[a(n,{icon:"pi pi-eye",class:"p-button-rounded p-button-success mr-2",onClick:E=>N(o.data)},null,8,["onClick"]),b(a(n,{icon:"pi pi-trash",class:"p-button-rounded p-button-warning",onClick:E=>T(o.data)},null,8,["onClick"]),[[v,["storage:d"]]])]),_:1})]),_:1},8,["data","columns","selection","filter"]),a(S,{visible:c.value,"onUpdate:visible":e[3]||(e[3]=o=>c.value=o),style:{width:"450px"},header:"Confirm",modal:!0},{footer:i(()=>[a(n,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:e[2]||(e[2]=o=>c.value=!1)}),a(n,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:$})]),default:i(()=>{var o;return[l("div",se,[ie,l("span",null,[C("你確定要刪除 "),l("b",null,O((o=p.value)==null?void 0:o.id),1),C(" 嗎?")])])]}),_:1},8,["visible"]),a(S,{visible:d.value,"onUpdate:visible":e[5]||(e[5]=o=>d.value=o),style:{width:"450px"},header:"Confirm",modal:!0},{footer:i(()=>[a(n,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:e[4]||(e[4]=o=>d.value=!1)}),a(n,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:I})]),default:i(()=>[ne]),_:1},8,["visible"])])])])}}});export{he as default};
