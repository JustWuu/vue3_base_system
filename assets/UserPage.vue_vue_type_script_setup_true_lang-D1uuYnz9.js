import"./database-Cw0t9ydm.js";import z from"./user-DVNX4K8t.js";import{M as R}from"./member-Bv2MCHDI.js";import{C as H,A as I}from"./useFireStorage-B9wjvMUc.js";import{_ as Y}from"./InputTextFloat.vue_vue_type_script_setup_true_lang-Byf_6CL9.js";import G from"./role-BqC8HwM7.js";import{d as _,r as f,b as $,q as c,o as i,c as p,D as F,f as k,a,e as o,m as L,A as C,F as N,y as J,k as K,M as Q,H as W,L as X,C as x,n as Z,u as r,E as ee}from"./index-IOU40qfs.js";import{_ as le}from"./StateDropdownFloat.vue_vue_type_script_setup_true_lang-C4ILou5S.js";import{_ as M}from"./DebounceButton.vue_vue_type_script_setup_true_lang-XnDk7Iq6.js";import{s as D,e as U}from"./useToast-BWUqdmsh.js";/* empty css                                                                       */import{F as S}from"./FloatText-efi5VUUk.js";import"./Editor-kc3vYnik.js";const te={class:"p-float-label"},ae=["for"],oe=_({__name:"RoleDropdownFloat",props:{modelValue:[String,Number,Object],type:{type:String,default:"text"},label:{type:String,default:"權限"},name:{type:String,default:"-"},placeholder:{type:String},rules:{type:String},disabled:{type:Boolean}},setup(e){const V=new G,v=f([{id:"",displayName:"無"}]),m=f(0);return $(()=>{V.array().then(d=>{d.filter(u=>v.value.push({id:u.id,displayName:u.displayName}))}),setTimeout(()=>{m.value==0&&m.value++},500)}),(d,u)=>{const b=c("Dropdown"),g=c("VField"),y=c("ErrorMessage");return i(),p(N,null,[(i(),F(g,{key:m.value,name:e.name,label:e.label,type:e.type,class:"p-inputtext p-component",rules:e.rules,value:e.modelValue,onChange:u[0]||(u[0]=l=>d.$emit("update:modelValue",l.value))},{default:k(({field:l})=>[a("span",te,[o(b,L({class:["w-full",{"p-filled":e.modelValue}]},l,{modelValue:e.modelValue,value:e.modelValue,placeholder:e.placeholder,id:e.name,options:v.value,optionLabel:"displayName",disabled:e.disabled}),null,16,["class","modelValue","value","placeholder","id","options","disabled"]),a("label",{for:e.name},C(e.label),9,ae)])]),_:1},8,["name","label","type","rules","value"])),o(y,{name:e.name,class:"p-error"},null,8,["name"])],64)}}}),se={class:"p-float-label"},ne=["for"],ie=_({__name:"MemberDropdownFloat",props:{modelValue:[String,Number,Object],type:{type:String,default:"text"},label:{type:String,default:"會員"},name:{type:String,default:"-"},placeholder:{type:String},rules:{type:String},disabled:{type:Boolean},filter:{type:Boolean,default:!0}},setup(e){const V=new R,v=f([]),m=f(0);return $(()=>{V.array().then(d=>{v.value=d}),setTimeout(()=>{m.value==0&&m.value++},500)}),(d,u)=>{const b=c("Dropdown"),g=c("VField"),y=c("ErrorMessage");return i(),p(N,null,[(i(),F(g,{key:m.value,name:e.name,label:e.label,type:e.type,class:"p-inputtext p-component",rules:e.rules,value:e.modelValue,onChange:u[0]||(u[0]=l=>d.$emit("update:modelValue",l.value))},{default:k(({field:l})=>[a("span",se,[o(b,L({class:["w-full",{"p-filled":e.modelValue}]},l,{modelValue:e.modelValue,value:e.modelValue,placeholder:e.placeholder,id:e.name,options:v.value,optionLabel:"email",disabled:e.disabled,filter:e.filter}),null,16,["class","modelValue","value","placeholder","id","options","disabled","filter"]),a("label",{for:e.name},C(e.label),9,ne)])]),_:1},8,["name","label","type","rules","value"])),o(y,{name:e.name,class:"p-error"},null,8,["name"])],64)}}}),de={class:"grid"},ue={class:"col-12 px-2"},re={class:"card p-fluid"},me={class:"flex"},ce={class:"flex align-items-center"},ve={key:0},fe={key:1,class:"m-0"},pe={key:0,class:"flex-1"},be={class:"flex justify-content-end align-items-center"},ye={class:"mr-1"},he={class:"flex justify-content-end"},Ve={class:"grid p-fluid mt-3"},ge={class:"col-12 md:col-6"},we={class:"col-12 md:col-6"},xe={class:"col-12 md:col-6"},Fe={class:"col-12 md:col-6"},ke={class:"col-12 md:col-6"},Ce={class:"col-12 md:col-6"},De=a("div",{class:"md:col-6"},null,-1),Ue={class:"col-12 md:col-6"},Se=a("div",{class:"flex align-items-center justify-content-center"},[a("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}}),a("span",null,"是否發送重設密碼信件？")],-1),Te=_({__name:"UserPage",props:{mode:{type:String,default:""}},setup(e){const V=J(),v=K(),m=new H,d=e,u=new I,b=new z,g=new R,y=f(""),l=f({...Q}),w=f(),h=f(!1),E=async s=>{d.mode==="add"?u.membersBecomeUser(w.value,s).then(t=>{t&&(D(t),v.push("/system/user/list"))}).catch(t=>{U(t)}):d.mode==="edit"&&b.updateUser(s).then(t=>{D(t),v.push("/system/user/list")}).catch(t=>{U(t)})},j=()=>{u.sendPassword(l.value.email).then(s=>{s&&(h.value=!1,D("重設密碼信件已寄出"))}).catch(s=>{h.value=!1,U(s)})},P=()=>{h.value=!0},q=()=>{h.value=!1};return $(()=>{d.mode==="edit"&&(y.value=V.params.id,b.get(y.value).then(s=>{l.value=s}))}),W(async()=>{if(w.value){const s=await g.getPublic(w.value.uid);l.value.uid=s.uid,l.value.displayName=s.displayName,l.value.photoURL=s.photoURL}}),(s,t)=>{const A=c("VForm"),B=c("Button"),O=c("Dialog"),T=X("role");return i(),p(N,null,[a("div",de,[a("div",ue,[o(A,{ref:"signupForm",onSubmit:t[5]||(t[5]=n=>E(l.value))},{default:k(()=>[a("div",re,[a("div",me,[a("div",ce,[e.mode==="add"?(i(),p("h5",ve,"新增帳號")):e.mode==="edit"?(i(),p("h5",fe,"編輯帳號")):x("",!0)]),e.mode==="edit"?(i(),p("div",pe,[a("div",be,[a("span",ye,C(l.value.emailVerified?"已驗證信箱":"未驗證信箱"),1),a("i",{id:"emailVerified",class:Z(["pi",{"pi-check-circle text-green-500":l.value.emailVerified,"pi-times-circle text-red-400":!l.value.emailVerified}])},null,2)]),a("div",he,[a("span",null,"上次登入時間 "+C(r(m).convertDate(l.value.operateAt)),1)])])):x("",!0)]),a("div",Ve,[a("div",ge,[e.mode==="add"?(i(),F(r(ie),{key:0,modelValue:w.value,"onUpdate:modelValue":t[0]||(t[0]=n=>w.value=n),name:"email",rules:"required"},null,8,["modelValue"])):x("",!0),e.mode==="edit"?(i(),F(r(S),{key:1,label:"信箱",content:l.value.email},null,8,["content"])):x("",!0)]),a("div",we,[o(r(S),{label:"UID",content:l.value.uid},null,8,["content"])]),a("div",xe,[o(r(S),{label:"名稱",content:l.value.displayName},null,8,["content"])]),a("div",Fe,[o(r(Y),{label:"照片",modelValue:l.value.photoURL,"onUpdate:modelValue":t[1]||(t[1]=n=>l.value.photoURL=n),name:"photoURL"},null,8,["modelValue"])]),a("div",ke,[o(r(le),{modelValue:l.value.state,"onUpdate:modelValue":t[2]||(t[2]=n=>l.value.state=n),name:"state",rules:"required"},null,8,["modelValue"])]),ee((i(),p("div",Ce,[o(r(oe),{modelValue:l.value.role,"onUpdate:modelValue":t[3]||(t[3]=n=>l.value.role=n),name:"role",rules:"required"},null,8,["modelValue"])])),[[T,["role:r"]]]),De,a("div",Ue,[e.mode==="edit"?(i(),F(r(M),{key:0,label:"重設密碼",type:"button",severity:"warning",onClick:t[4]||(t[4]=n=>P())})):x("",!0)])]),o(r(M),{label:"送出",type:"submit"})])]),_:1},512)])]),o(O,{header:"確認",visible:h.value,"onUpdate:visible":t[7]||(t[7]=n=>h.value=n),style:{width:"350px"},modal:!0},{footer:k(()=>[o(B,{label:"No",icon:"pi pi-times",onClick:q,class:"p-button-text",autofocus:""}),o(B,{label:"Yes",icon:"pi pi-check",onClick:t[6]||(t[6]=n=>j()),class:"p-button-text"})]),default:k(()=>[Se]),_:1},8,["visible"])],64)}}});export{Te as _};
