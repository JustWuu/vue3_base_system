import"./database-B5yYN_Wa.js";import O from"./user-QzlZX5LK.js";import{A as T}from"./useFireStorage-H2zJQsii.js";import{_ as z}from"./InputPasswordFloat.vue_vue_type_script_setup_true_lang-Dxz2FEap.js";import{_ as S}from"./InputTextFloat.vue_vue_type_script_setup_true_lang-DW-OHmpI.js";import I from"./role-D5Fe5TFx.js";import{d as D,r as y,b as U,q as p,o as n,c as f,D as g,f as w,a,e as s,m as q,A as k,F as $,y as Y,k as G,M as H,L as J,C as h,n as K,u as i,E as Q}from"./index-BAnCtb42.js";import{S as W}from"./Universal-Q_iCI1DR.js";import{_}from"./DebounceButton.vue_vue_type_script_setup_true_lang-DYB4wk4f.js";import{C as X}from"./useDate-CVzJcmyJ.js";import{s as F,e as C}from"./useToast-DKlWDkpx.js";/* empty css                                                                       */import{F as B}from"./FloatText-CP6DqJnA.js";import"./index-CkfW3gqd.js";const Z={class:"p-float-label"},ee=["for"],le=D({__name:"RoleDropdownFloat",props:{modelValue:[String,Number,Object],type:{type:String,default:"text"},label:{type:String,default:"權限"},name:{type:String,default:"-"},placeholder:{type:String},rules:{type:String},disabled:{type:Boolean}},setup(e){const x=new I,c=y([{id:"",displayName:"無"}]),v=y(0);return U(()=>{x.array().then(d=>{d.filter(u=>c.value.push({id:u.id,displayName:u.displayName}))}),setTimeout(()=>{v.value==0&&v.value++},500)}),(d,u)=>{const b=p("Dropdown"),V=p("VField"),t=p("ErrorMessage");return n(),f($,null,[(n(),g(V,{key:v.value,name:e.name,label:e.label,type:e.type,class:"p-inputtext p-component",rules:e.rules,value:e.modelValue,onChange:u[0]||(u[0]=r=>d.$emit("update:modelValue",r.value))},{default:w(({field:r})=>[a("span",Z,[s(b,q({class:["w-full",{"p-filled":e.modelValue}]},r,{modelValue:e.modelValue,value:e.modelValue,placeholder:e.placeholder,id:e.name,options:c.value,optionLabel:"displayName",disabled:e.disabled}),null,16,["class","modelValue","value","placeholder","id","options","disabled"]),a("label",{for:e.name},k(e.label),9,ee)])]),_:1},8,["name","label","type","rules","value"])),s(t,{name:e.name,class:"p-error"},null,8,["name"])],64)}}}),te={class:"p-float-label"},ae=["for"],oe=D({__name:"StateDropdownFloat",props:{modelValue:[String,Number,Object],type:{type:String,default:"text"},label:{type:String,default:"狀態"},name:{type:String,default:"-"},placeholder:{type:String},rules:{type:String},disabled:{type:Boolean}},setup(e){const x=y([...W]),c=y(0);return U(()=>{setTimeout(()=>{c.value==0&&c.value++},500)}),(v,d)=>{const u=p("Dropdown"),b=p("VField"),V=p("ErrorMessage");return n(),f($,null,[(n(),g(b,{key:c.value,name:e.name,label:e.label,type:e.type,class:"p-inputtext p-component",rules:e.rules,value:e.modelValue,onChange:d[0]||(d[0]=t=>v.$emit("update:modelValue",t.value))},{default:w(({field:t})=>[a("span",te,[s(u,q({class:["w-full",{"p-filled":e.modelValue}]},t,{modelValue:e.modelValue,value:e.modelValue,placeholder:e.placeholder,id:e.name,options:x.value,optionLabel:"text",optionValue:"value",disabled:e.disabled}),null,16,["class","modelValue","value","placeholder","id","options","disabled"]),a("label",{for:e.name},k(e.label),9,ae)])]),_:1},8,["name","label","type","rules","value"])),s(V,{name:e.name,class:"p-error"},null,8,["name"])],64)}}}),se={class:"grid"},ne={class:"col-12 px-2"},ie={class:"card p-fluid"},de={class:"flex"},ue={class:"flex align-items-center"},re={key:0},me={key:1,class:"m-0"},ce={key:0,class:"flex-1"},pe={class:"flex justify-content-end align-items-center"},ve={class:"mr-1"},fe={class:"flex justify-content-end"},ye={class:"grid p-fluid mt-3"},be={class:"col-12 md:col-6"},Ve={class:"col-12 md:col-6"},he={class:"col-12 md:col-6"},ge={class:"col-12 md:col-6"},xe={class:"col-12 md:col-6"},we={class:"col-12 md:col-6"},ke=a("div",{class:"md:col-6"},null,-1),Se={class:"col-12 md:col-6"},Fe=a("div",{class:"flex align-items-center justify-content-center"},[a("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}}),a("span",null,"是否發送重設密碼信件？")],-1),Pe=D({__name:"UserPage",props:{mode:{type:String,default:""}},setup(e){const x=Y(),c=G(),v=new X,d=e,u=new T,b=new O,V=y(""),t=y({...H}),r=y(!1),R=async m=>{d.mode==="add"?u.createUser(m).then(l=>{l&&(F(l),c.push("/system/user/list"))}).catch(l=>{C(l)}):d.mode==="edit"&&b.updateUser(m).then(l=>{F(l),c.push("/system/user/list")}).catch(l=>{C(l)})},j=()=>{u.sendPassword(t.value.email).then(m=>{m&&(r.value=!1,F("重設密碼信件已寄出"))}).catch(m=>{r.value=!1,C(m)})},E=()=>{r.value=!0},L=()=>{r.value=!1};return U(()=>{d.mode==="edit"&&(V.value=x.params.id,b.get(V.value).then(m=>{console.log(m),t.value=m}))}),(m,l)=>{const M=p("VForm"),N=p("Button"),A=p("Dialog"),P=J("role");return n(),f($,null,[a("div",se,[a("div",ne,[s(M,{ref:"signupForm",onSubmit:l[7]||(l[7]=o=>R(t.value))},{default:w(()=>[a("div",ie,[a("div",de,[a("div",ue,[e.mode==="add"?(n(),f("h5",re,"新增帳號")):e.mode==="edit"?(n(),f("h5",me,"編輯帳號")):h("",!0)]),e.mode==="edit"?(n(),f("div",ce,[a("div",pe,[a("span",ve,k(t.value.emailVerified?"已驗證信箱":"未驗證信箱"),1),a("i",{id:"emailVerified",class:K(["pi",{"pi-check-circle text-green-500":t.value.emailVerified,"pi-times-circle text-red-400":!t.value.emailVerified}])},null,2)]),a("div",fe,[a("span",null,"上次登入時間 "+k(i(v).convertDate(t.value.operateAt)),1)])])):h("",!0)]),a("div",ye,[a("div",be,[e.mode==="add"?(n(),g(i(S),{key:0,label:"信箱",modelValue:t.value.email,"onUpdate:modelValue":l[0]||(l[0]=o=>t.value.email=o),name:"email",rules:"required|email"},null,8,["modelValue"])):h("",!0),e.mode==="edit"?(n(),g(i(B),{key:1,label:"信箱",content:t.value.email},null,8,["content"])):h("",!0)]),a("div",Ve,[e.mode==="add"?(n(),g(i(z),{key:0,label:"密碼",modelValue:t.value.password,"onUpdate:modelValue":l[1]||(l[1]=o=>t.value.password=o),name:"password",rules:"required"},null,8,["modelValue"])):h("",!0),e.mode==="edit"?(n(),g(i(B),{key:1,label:"UID",content:t.value.uid},null,8,["content"])):h("",!0)]),a("div",he,[s(i(S),{label:"名稱",modelValue:t.value.displayName,"onUpdate:modelValue":l[2]||(l[2]=o=>t.value.displayName=o),name:"displayName",rules:"required"},null,8,["modelValue"])]),a("div",ge,[s(i(S),{label:"照片",modelValue:t.value.photoURL,"onUpdate:modelValue":l[3]||(l[3]=o=>t.value.photoURL=o),name:"photoURL",rules:"required"},null,8,["modelValue"])]),a("div",xe,[s(i(oe),{modelValue:t.value.state,"onUpdate:modelValue":l[4]||(l[4]=o=>t.value.state=o),name:"state",rules:"required"},null,8,["modelValue"])]),Q((n(),f("div",we,[s(i(le),{modelValue:t.value.role,"onUpdate:modelValue":l[5]||(l[5]=o=>t.value.role=o),name:"role",rules:"required"},null,8,["modelValue"])])),[[P,["role:u"]]]),ke,a("div",Se,[s(i(_),{label:"重設密碼",type:"button",severity:"warning",onClick:l[6]||(l[6]=o=>E())})])]),s(i(_),{label:"送出",type:"submit"})])]),_:1},512)])]),s(A,{header:"確認",visible:r.value,"onUpdate:visible":l[9]||(l[9]=o=>r.value=o),style:{width:"350px"},modal:!0},{footer:w(()=>[s(N,{label:"No",icon:"pi pi-times",onClick:L,class:"p-button-text",autofocus:""}),s(N,{label:"Yes",icon:"pi pi-check",onClick:l[8]||(l[8]=o=>j()),class:"p-button-text"})]),default:w(()=>[Fe]),_:1},8,["visible"])],64)}}});export{Pe as _};
