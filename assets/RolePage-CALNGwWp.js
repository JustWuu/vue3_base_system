import{R as $}from"./database-B5yYN_Wa.js";import B from"./role-D5Fe5TFx.js";import"./useFireStorage-H2zJQsii.js";import{d as x,r as v,b as C,q as b,o as n,c as g,D as V,f as N,a as t,e as d,m as D,A as I,F as K,y as M,k as P,C as w,u as f,t as q,v as A,_ as E}from"./index-BAnCtb42.js";import{_ as U}from"./InputTextFloat.vue_vue_type_script_setup_true_lang-DW-OHmpI.js";import{S as O}from"./Universal-Q_iCI1DR.js";import{_ as W}from"./DebounceButton.vue_vue_type_script_setup_true_lang-DYB4wk4f.js";import{s as _,e as F}from"./useToast-DKlWDkpx.js";/* empty css                                                                       */import{F as j}from"./FloatText-CP6DqJnA.js";import"./index-CkfW3gqd.js";const L={class:"p-float-label"},z=["for"],G=x({__name:"InputDropdownFloat",props:{modelValue:[String,Number],type:{type:String,default:"text"},label:{type:String,default:"-"},name:{type:String,default:"-"},placeholder:{type:String},rules:{type:String},options:{type:Array},disabled:{type:Boolean}},setup(e){const u=v(0);return C(()=>{setTimeout(()=>{u.value==0&&u.value++},500)}),(k,c)=>{const p=b("Dropdown"),m=b("VField"),s=b("ErrorMessage");return n(),g(K,null,[(n(),V(m,{key:u.value,name:e.name,label:e.label,type:e.type,class:"p-inputtext p-component",rules:e.rules,value:e.modelValue,onChange:c[0]||(c[0]=a=>k.$emit("update:modelValue",a.value))},{default:N(({field:a})=>[t("span",L,[d(p,D({class:["w-full",{"p-filled":e.modelValue}]},a,{modelValue:e.modelValue,value:e.modelValue,placeholder:e.placeholder,id:e.name,options:e.options,optionLabel:"text",optionValue:"value",disabled:e.disabled}),null,16,["class","modelValue","value","placeholder","id","options","disabled"]),t("label",{for:e.name},I(e.label),9,z)])]),_:1},8,["name","label","type","rules","value"])),d(s,{name:e.name,class:"p-error"},null,8,["name"])],64)}}}),H=e=>(q("data-v-79bd223f"),e=e(),A(),e),J={class:"grid"},Q={class:"col-12 px-2"},X={class:"card p-fluid"},Y={key:0},Z={key:1},ee={class:"grid p-fluid mt-3"},le={class:"col-12 md:col-6"},ae={class:"col-12 md:col-6"},oe={class:"col-12"},te=H(()=>t("h5",null,"權限設定",-1)),se=x({__name:"RolePage",props:{mode:{type:String,default:""}},setup(e){const u=new $,k=M(),c=P(),p=e,m=new B,s=v(""),a=v({displayName:"",roles:[],id:"",state:"enable"}),R=v([{key:"system",label:"系統",data:"system",icon:"pi pi-fw pi-inbox",children:[{key:"user",label:"帳號管理",data:"user",icon:"pi pi-fw pi-users",children:[{key:"user:c",label:"新增",icon:"pi pi-fw pi-file",data:"user:c"},{key:"user:r",label:"查看",icon:"pi pi-fw pi-eye",data:"user:r"},{key:"user:u",label:"更新",icon:"pi pi-fw pi-pencil",data:"user:u"},{key:"user:d",label:"刪除",icon:"pi pi-fw pi-trash",data:"user:d"}]},{key:"role",label:"權限管理",data:"role",icon:"pi pi-fw pi-sitemap",children:[{key:"role:c",label:"新增",icon:"pi pi-fw pi-file",data:"role:c"},{key:"role:r",label:"查看",icon:"pi pi-fw pi-eye",data:"role:r"},{key:"role:u",label:"更新",icon:"pi pi-fw pi-pencil",data:"role:u"},{key:"role:d",label:"刪除",icon:"pi pi-fw pi-trash",data:"role:d"}]},{key:"syslog",label:"操作紀錄",data:"syslog",icon:"pi pi-fw pi-wrench",children:[{key:"syslog:c",label:"新增",icon:"pi pi-fw pi-file",data:"syslog:c"},{key:"syslog:r",label:"查看",icon:"pi pi-fw pi-eye",data:"syslog:r"},{key:"syslog:u",label:"更新",icon:"pi pi-fw pi-pencil",data:"syslog:u"},{key:"syslog:d",label:"刪除",icon:"pi pi-fw pi-trash",data:"syslog:d"}]}]}]),i=v({}),T=async o=>{p.mode==="add"?(s.value=u.generateRandomString(10),a.value.id=s.value,a.value.roles=S(),m.set(s.value,o).then(l=>{_(l),c.push("/system/role/list")}).catch(l=>{F(l)})):p.mode==="edit"&&(a.value.roles=S(),m.update(s.value,o).then(l=>{_(l),c.push("/system/role/list")}).catch(l=>{F(l)}))},S=()=>{const o=[];for(var l in i.value)Object.prototype.hasOwnProperty.call(i.value,l)&&i.value[l].checked===!0&&o.push(l);return o};return C(()=>{p.mode==="edit"&&(s.value=k.params.id,m.get(s.value).then(o=>{a.value=o;for(var l=0;l<o.roles.length;l++)if(o.roles[l].includes(":")){var h=o.roles[l].split(":")[0];i.value[h]||(i.value[h]={checked:!1,partialChecked:!0})}for(var y=0;y<o.roles.length;y++)i.value[o.roles[y]]={checked:!0,partialChecked:!1}}))}),(o,l)=>{const h=b("Tree"),y=b("VForm");return n(),g("div",J,[t("div",Q,[d(y,{ref:"signupForm",onSubmit:l[3]||(l[3]=r=>T(a.value))},{default:N(()=>[t("div",X,[e.mode==="add"?(n(),g("h5",Y,"新增權限身分")):e.mode==="edit"?(n(),g("h5",Z,"編輯權限身分")):w("",!0),t("div",ee,[t("div",le,[e.mode==="add"?(n(),V(f(U),{key:0,label:"名稱",modelValue:a.value.displayName,"onUpdate:modelValue":l[0]||(l[0]=r=>a.value.displayName=r),name:"displayName",rules:"required"},null,8,["modelValue"])):w("",!0),e.mode==="edit"?(n(),V(f(j),{key:1,label:"名稱",content:a.value.displayName},null,8,["content"])):w("",!0)]),t("div",ae,[d(f(G),{label:"狀態",options:f(O),modelValue:a.value.state,"onUpdate:modelValue":l[1]||(l[1]=r=>a.value.state=r),name:"state",rules:"required"},null,8,["options","modelValue"])]),t("div",oe,[te,d(h,{value:R.value,selectionMode:"checkbox",selectionKeys:i.value,"onUpdate:selectionKeys":l[2]||(l[2]=r=>i.value=r),expandedKeys:{system:!0,user:!0,role:!0,syslog:!0}},null,8,["value","selectionKeys"])])]),d(f(W),{label:"送出",type:"submit"})])]),_:1},512)])])}}}),be=E(se,[["__scopeId","data-v-79bd223f"]]);export{be as R};
